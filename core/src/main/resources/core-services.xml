<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2009 Igor Azarnyi, Denys Pavlov
  ~
  ~    Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:cache="http://www.springframework.org/schema/cache"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/cache
	                       http://www.springframework.org/schema/cache/spring-cache.xsd">

    <cache:annotation-driven />

    <import resource="classpath:dao.xml"/>
    <import resource="cache-config.xml"/>
    <import resource="core-cronjob.xml"/>

    <bean id="priceNavigation" class="org.yes.cart.domain.query.impl.PriceNavigationImpl"/>

    <bean id="hashHelper" class="org.yes.cart.service.domain.impl.MD5HashHelperImpl" scope="prototype"/>

    <bean id="attributeLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.AttributeSearchQueryBuilder"/>
    <bean id="attributeSkuLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.AttributeSkuSearchQueryBuilder"/>
    <bean id="featuredProductLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.FeaturedProductSearchQueryBuilder"/>
    <bean id="keywordProductLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.KeywordProductSearchQueryBuilder"/>
    <bean id="keywordProductSkuLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.KeywordProductSkuSearchQueryBuilder"/>
    <bean id="priceLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.PriceSearchQueryBuilder">
        <constructor-arg index="0" ref="priceNavigation"/>
    </bean>
    <bean id="brandLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.ProductBrandSearchQueryBuilder"/>
    <bean id="productCategoryLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.ProductCategorySearchQueryBuilder"/>
    <bean id="productShopLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.ProductShopSearchQueryBuilder"/>
    <bean id="productIdLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.ProductIdSearchQueryBuilder"/>
    <bean id="productCodeLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.ProductSkuCodeSearchQueryBuilder"/>
    <bean id="productSkuIdLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.ProductSkuIdSearchQueryBuilder"/>
    <bean id="productTagLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.ProductTagSearchQueryBuilder"/>
    <bean id="noopLuceneQueryBuilder" class="org.yes.cart.domain.query.impl.NoopProductSearchQueryBuilder"/>

    <bean id="luceneQueryFactory" class="org.yes.cart.domain.query.impl.LuceneQueryFactoryImpl">
        <constructor-arg index="0" type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
        <constructor-arg index="1" type="org.yes.cart.service.domain.ProductService" ref="productService"/>
        <constructor-arg index="2" type="org.yes.cart.service.domain.CategoryService" ref="categoryService"/>
        <constructor-arg index="3">
            <map>
                <!-- Direct sku from URL or in code -->
                <entry key="sku"            value-ref="productSkuIdLuceneQueryBuilder"/>
                <entry key="sku.skuId"      value-ref="productSkuIdLuceneQueryBuilder"/>
                <entry key="sku.code"       value-ref="productCodeLuceneQueryBuilder"/>
                <!-- Direct product from URL or in code -->
                <entry key="product"        value-ref="productIdLuceneQueryBuilder"/>
                <entry key="productId"      value-ref="productIdLuceneQueryBuilder"/>

                <!-- Searching from url -->
                <entry key="brand"          value-ref="brandLuceneQueryBuilder"/>
                <entry key="query"          value-ref="keywordProductLuceneQueryBuilder"/>
                <entry key="tag"            value-ref="productTagLuceneQueryBuilder"/>
                <entry key="price"          value-ref="priceLuceneQueryBuilder"/>

                <!-- Internal -->
                <entry key="attribute.attribute"           value-ref="attributeLuceneQueryBuilder"/>
                <entry key="productCategory.category"      value-ref="productCategoryLuceneQueryBuilder"/>
                <entry key="productShopId"                 value-ref="productShopLuceneQueryBuilder"/>
                <entry key="featured"                      value-ref="featuredProductLuceneQueryBuilder"/>
            </map>
        </constructor-arg>
        <constructor-arg>
            <map>
                <!-- Direct sku from URL or in code -->
                <entry key="sku"            value-ref="noopLuceneQueryBuilder"/>
                <entry key="sku.skuId"      value-ref="noopLuceneQueryBuilder"/>
                <entry key="sku.code"       value-ref="productCodeLuceneQueryBuilder"/>
                <!-- Direct product from URL or in code -->
                <entry key="product"        value-ref="productIdLuceneQueryBuilder"/>
                <entry key="productId"      value-ref="productIdLuceneQueryBuilder"/>

                <!-- Searching from url -->
                <entry key="brand"          value-ref="noopLuceneQueryBuilder"/>
                <entry key="query"          value-ref="keywordProductSkuLuceneQueryBuilder"/>
                <entry key="tag"            value-ref="noopLuceneQueryBuilder"/>
                <entry key="price"          value-ref="priceLuceneQueryBuilder"/>

                <!-- Internal -->
                <entry key="attribute.attribute"           value-ref="attributeSkuLuceneQueryBuilder"/>
                <entry key="productCategory.category"      value-ref="noopLuceneQueryBuilder"/>
                <entry key="productShopId"                 value-ref="noopLuceneQueryBuilder"/>
                <entry key="featured"                      value-ref="noopLuceneQueryBuilder"/>
            </map>
        </constructor-arg>
        <constructor-arg index="5">
            <set>
                <value>query</value>
            </set>
        </constructor-arg>
    </bean>

    <bean id="systemService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.SystemServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="systemDao"/>
                <constructor-arg type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
                <lookup-method name="getSelf" bean="systemService"/>
            </bean>
        </property>
    </bean>


    <bean id="shopService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
                <constructor-arg type="org.yes.cart.service.domain.CategoryService" ref="categoryService"/>
                <constructor-arg type="org.yes.cart.service.domain.ContentService" ref="contentService"/>
                <constructor-arg type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
            </bean>
        </property>
    </bean>


    <bean id="shoppingCartStateService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShoppingCartStateServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shoppingCartStateDao"/>
            </bean>
        </property>
    </bean>


    <bean id="shopUrlService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopUrlServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopUrlDao"/>
            </bean>
        </property>
    </bean>


    <bean id="categoryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CategoryServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="categoryDao"/>
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopCategoryDao"/>
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
                <lookup-method name="getSelf" bean="categoryService"/>
            </bean>
        </property>
    </bean>

    <bean id="groovyContentServiceTemplateSupport" class="org.yes.cart.service.domain.impl.ContentServiceTemplateSupportGroovyImpl"/>

    <bean id="contentService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ContentServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="categoryDao"/>
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopCategoryDao"/>
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
                <constructor-arg type="org.yes.cart.service.domain.ContentServiceTemplateSupport" ref="groovyContentServiceTemplateSupport"/>
                <lookup-method name="getSelf" bean="contentService"/>
            </bean>
        </property>
    </bean>

    <bean id="prodTypeAttributeViewGroupService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProdTypeAttributeViewGroupServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="prodTypeAttributeViewGroupDao"/>
            </bean>
        </property>
    </bean>

    <bean id="productService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productDao"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="productSkuDao"/>
                <constructor-arg index="2" type="org.yes.cart.service.domain.ProductSkuService" ref="productSkuService"/>
                <constructor-arg index="3" type="org.yes.cart.service.domain.ProductTypeAttrService" ref="productTypeAttrService"/>
                <constructor-arg index="4" type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
                <constructor-arg index="5" type="org.yes.cart.dao.GenericDAO" ref="productCategoryDao"/>
                <constructor-arg index="6" type="org.yes.cart.dao.GenericDAO" ref="productTypeAttrDao"/>
                <constructor-arg index="7" type="org.yes.cart.domain.entity.bridge.support.ShopCategoryRelationshipSupport" ref="shopCategoryRelationshipSupport"/>
                <lookup-method name="getSelf" bean="productService"/>
            </bean>
        </property>
    </bean>


    <bean id="productSkuService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductSkuServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productSkuDao"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="productDao"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="skuPriceDao"/>
            </bean>
        </property>
    </bean>

    <bean id="productAvailabilityStrategy"
          class="org.yes.cart.service.domain.impl.ProductAvailabilityStrategyImpl">
        <constructor-arg index="0" ref="warehouseService"/>
        <constructor-arg index="1" ref="skuWarehouseService"/>
    </bean>

    <bean id="productQuantityStrategy"
          class="org.yes.cart.service.domain.impl.ProductQuantityStrategyImpl"/>

    <bean id="addressService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.AddressServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="addressDao"/>
            </bean>
        </property>
    </bean>



    <bean id="customerWishListService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerWishListServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="customerWishListDao"/>
            </bean>
        </property>
    </bean>



    <bean id="attributeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.AttributeServiceImpl">
                <constructor-arg index="0" ref="attributeDao"/>
                <constructor-arg index="1" ref="attributeGroupService"/>
            </bean>
        </property>
    </bean>

    <bean id="runtimeAttributeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.RuntimeAttributeServiceImpl">
                <constructor-arg index="0" ref="attributeService"/>
                <constructor-arg index="1" ref="etypeService"/>
                <constructor-arg index="2" ref="attributeGroupService"/>
            </bean>
        </property>
    </bean>


    <!--     #############################   Image section begin   #############################    -->

    <bean id="categoryImageNameStrategy" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.service.image.impl.CategoryImageNameStrategyImpl">
                <constructor-arg index="0" value="category"/>
                <constructor-arg index="1" ref="attrValueEntityCategoryDao"/>
                <constructor-arg index="2" ref="languageService"/>
            </bean>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
            </props>
        </property>
    </bean>


    <bean id="productImageNameStrategy" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.service.image.impl.ProductImageNameStrategyImpl">
                <constructor-arg index="0" value="product"/>
                <constructor-arg index="1" ref="attrValueEntityProductSkuDao"/>
                <constructor-arg index="2" ref="attrValueEntityProductDao"/>
                <constructor-arg index="3" ref="languageService"/>
            </bean>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
            </props>
        </property>
    </bean>

    <bean id="brandImageNameStrategy" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.service.image.impl.BrandImageNameStrategyImpl">
                <constructor-arg index="0" value="brand"/>
                <constructor-arg index="1" ref="attrValueEntityBrandDao"/>
                <constructor-arg index="2" ref="languageService"/>
            </bean>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
            </props>
        </property>
    </bean>

    <bean id="shopImageNameStrategy" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.image.impl.ShopImageNameStrategyImpl">
                <constructor-arg index="0" value="shop"/>
                <constructor-arg index="1" ref="attrValueEntityShopDao"/>
                <constructor-arg index="2" ref="languageService"/>
            </bean>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
            </props>
        </property>
    </bean>


    <bean id="imageNameStrategyResolver" class="org.yes.cart.service.image.impl.ImageNameStrategyResolverImpl">
        <constructor-arg index="0" ref="productImageNameStrategy"/>
        <constructor-arg index="1">
            <list>
                <ref bean="categoryImageNameStrategy"/>
                <ref bean="brandImageNameStrategy"/>
                <ref bean="productImageNameStrategy"/>
                <ref bean="shopImageNameStrategy"/>
            </list>
        </constructor-arg>
    </bean>

    <!--
    Responsible:
        image resizing;
        storing images into repository during bulk import;
        work with brand, product, sku and category images.
    -->

    <bean id="imageService" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.service.domain.impl.ImageServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="seoImageDao"/>
                <constructor-arg type="org.yes.cart.service.image.ImageNameStrategyResolver" ref="imageNameStrategyResolver"/>
                <!--
                    Allowed pictures sizes to resize. Original image will be returned if requested size not allowed.
                -->
                <constructor-arg type="java.lang.String" value="40x40,50x50,60x60,80x80,200x200,160x160,360x360,120x120,280x280,240x240"/>
                <!--
                    Background RGB color for re-sized picture. When picture is scaled this is the border
                    color around the picture where it does not fill all the space
                -->
                <constructor-arg type="int" value="255"/>
                <constructor-arg type="int" value="255"/>
                <constructor-arg type="int" value="255"/>
                <!--
                    cropToFit setting this to true will crop the image to proper ratio prior to scaling
                    so that scaled image fills all the space. This is useful for those who wish to have
                    images that fill all space dedicated for image without having border around the image.
                    For those who wish images of products in the middle e.g. as it is in YC demo better
                    to set this to false.
                -->
                <constructor-arg type="boolean" value="false"/>
                <!--
                    forceCropToFitOnSize forcefully use cropping if scale is below given size.
                    This option is very useful for small thumbs (<100px), as you really cannot see much with
                    added padding for panoramic or tall images.
                -->
                <constructor-arg type="int" value="100"/>
                <!--
                    IO operations abstraction
                 -->
                <constructor-arg type="org.yes.cart.stream.io.IOProvider" ref="ioProviderFactory"/>
            </bean>
        </property>
    </bean>

    <!--     #############################   Image section end   #############################    -->

    <bean id="productAssociationService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductAssociationServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="productAssociationDao"/>
            </bean>
        </property>
    </bean>

    <bean id="associationService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.AssociationServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="associationDao"/>
            </bean>
        </property>
    </bean>

    <bean id="priceService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.PriceServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.query.PriceNavigation" ref="priceNavigation"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="skuPriceDao"/>
            </bean>
        </property>
    </bean>


    <bean id="attributeGroupService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.AttributeGroupServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="attributeGroupDao"/>
            </bean>
        </property>
    </bean>


    <bean id="etypeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.EtypeServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="etypeDao"/>
            </bean>
        </property>
    </bean>


    <bean id="shopCategoryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopCategoryServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="shopCategoryDao"/>
            </bean>
        </property>
    </bean>





    <bean id="brandService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.BrandServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="brandDao"/>
            </bean>
        </property>
    </bean>

    <bean id="carrierService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CarrierServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="carrierDao"/>
            </bean>
        </property>
    </bean>

    <bean id="carrierSlaService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CarrierSlaServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="carrierSlaDao"/>
            </bean>
        </property>
    </bean>

    <bean id="shopTopSellerService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopTopSellerServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="shopTopSellerDao"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="productDao"/>
            </bean>
        </property>
    </bean>


    <bean id="warehouseService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.WarehouseServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="warehouseDao"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="shopWarehouseDao"/>
            </bean>
        </property>
    </bean>


    <bean id="productTypeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductTypeServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productTypeDao"/>
            </bean>
        </property>
    </bean>


    <bean id="productTypeAttrService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductTypeAttrServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productTypeAttrDao"/>
            </bean>
        </property>
    </bean>

    <bean id="countryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CountryServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="countryDao"/>
            </bean>
        </property>
    </bean>

    <bean id="stateService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.StateServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="stateDao"/>
            </bean>
        </property>
    </bean>


    <bean id="productCategoryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductCategoryServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productCategoryDao"/>
            </bean>
        </property>
    </bean>


    <bean id="customerOrderService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerOrderServiceImpl">
                <constructor-arg index="0"  ref="customerOrderDao"/>
                <constructor-arg index="1"  ref="customerDao"/>
                <constructor-arg index="2"  ref="genericDao"/>
                <constructor-arg index="3"  ref="customerOrderDeliveryDao"/>
                <constructor-arg index="4"  ref="orderAssembler"/>
                <constructor-arg index="5"  ref="deliveryAssembler"/>
            </bean>
        </property>
    </bean>

    <bean id="customerOrderDeliveryDetService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerOrderDeliveryDetServiceImpl">
                <constructor-arg index="0"  ref="customerOrderDeliveryDetDao"/>
            </bean>
        </property>
    </bean>

    <bean id="customerService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="customerDao"/>
                <constructor-arg index="1" type="org.yes.cart.service.domain.HashHelper" ref="hashHelper"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="genericDao"/>
                <constructor-arg index="3" type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
                <constructor-arg index="4" type="org.yes.cart.service.domain.ShopService" ref="shopService"/>
                <constructor-arg index="5" type="org.yes.cart.service.customer.CustomerNameFormatter" ref="customerNameFormatter"/>
            </bean>
        </property>
    </bean>

    <bean id="managerService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ManagerServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="managerDao"/>
            </bean>
        </property>
    </bean>

    <bean id="skuWarehouseService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.SkuWarehouseServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="skuWarehouseDao"/>
                <property name="productService" ref="productService"/>
            </bean>
        </property>
    </bean>

    <bean id="promotionCouponService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.PromotionCouponServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="promotionCouponDao"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="promotionDao"/>
                <constructor-arg index="2">
                    <bean id="promotionCouponCodeGenerator" class="org.yes.cart.promotion.impl.PromotionCouponCodeGeneratorImpl">
                        <!-- CPOINT - generates 10 characters alpha num coupon codes -->
                        <constructor-arg index="0" value="10"/>
                    </bean>
                </constructor-arg>
            </bean>
        </property>
    </bean>

    <bean id="promotionService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.PromotionServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="promotionDao"/>
            </bean>
        </property>
    </bean>

    <bean id="promotionConditionParser" class="org.yes.cart.promotion.impl.GroovyPromotionConditionParser"/>

    <bean id="bestValuePromotionApplicationStrategy" class="org.yes.cart.promotion.impl.BestValuePromotionApplicationStrategyImpl">
        <constructor-arg index="0" ref="promotionCouponService"/>
    </bean>

    <bean id="promotionContextFactory" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.promotion.impl.PromotionContextFactoryImpl">
                <constructor-arg index="0" ref="shopService"/>
                <constructor-arg index="1" ref="promotionService"/>
                <constructor-arg index="2" ref="promotionConditionParser"/>
                <constructor-arg index="3">
                    <map>
                        <entry key="O">
                            <map>
                                <entry key="P" value-ref="promoActionOrderDiscount"/>
                                <entry key="S" value-ref="promoActionOrderNonSaleDiscount"/>
                                <entry key="F" value-ref="promoActionOrderAmountOff"/>
                                <entry key="G" value-ref="promoActionOrderGift"/>
                            </map>
                        </entry>
                        <entry key="S">
                            <map>
                                <entry key="P" value-ref="promoActionShippingDiscount"/>
                                <entry key="F" value-ref="promoActionShippingAmountOff"/>
                            </map>
                        </entry>
                        <entry key="I">
                            <map>
                                <entry key="P" value-ref="promoActionItemDiscount"/>
                                <entry key="S" value-ref="promoActionItemNonSaleDiscount"/>
                                <entry key="F" value-ref="promoActionItemAmountOff"/>
                                <entry key="G" value-ref="promoActionItemGift"/>
                            </map>
                        </entry>
                        <entry key="C">
                            <map>
                                <entry key="T" value-ref="promoActionCustomerTag"/>
                            </map>
                        </entry>
                    </map>
                </constructor-arg>
                <constructor-arg index="4" ref="bestValuePromotionApplicationStrategy"/>
                <lookup-method name="getSelf" bean="promotionContextFactory"/>
            </bean>
        </property>
    </bean>

    <bean id="promotionCouponContext" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.promotion.impl.PromotionCouponContextImpl">
                <constructor-arg index="0" ref="promotionCouponService"/>
                <constructor-arg index="1" ref="promotionConditionParser"/>
                <constructor-arg index="2">
                    <map>
                        <entry key="P" value-ref="promoActionOrderDiscount"/>
                        <entry key="S" value-ref="promoActionOrderNonSaleDiscount"/>
                        <entry key="F" value-ref="promoActionOrderAmountOff"/>
                    </map>
                </constructor-arg>
                <constructor-arg index="3" ref="bestValuePromotionApplicationStrategy"/>
            </bean>
        </property>
    </bean>

    <bean id="promoActionItemDiscount" class="org.yes.cart.promotion.impl.action.ItemDiscountPromotionAction"/>
    <bean id="promoActionItemNonSaleDiscount" class="org.yes.cart.promotion.impl.action.ItemNonSaleDiscountPromotionAction"/>
    <bean id="promoActionItemAmountOff" class="org.yes.cart.promotion.impl.action.ItemAmountOffPromotionAction"/>
    <bean id="promoActionItemGift" class="org.yes.cart.promotion.impl.action.ItemGiftPromotionAction">
        <constructor-arg index="0" ref="priceService"/>
        <constructor-arg index="1" ref="shopService"/>
    </bean>

    <bean id="promoActionOrderDiscount" class="org.yes.cart.promotion.impl.action.OrderDiscountPromotionAction"/>
    <bean id="promoActionOrderNonSaleDiscount" class="org.yes.cart.promotion.impl.action.OrderNonSaleDiscountPromotionAction"/>
    <bean id="promoActionOrderAmountOff" class="org.yes.cart.promotion.impl.action.OrderAmountOffPromotionAction"/>
    <bean id="promoActionOrderGift" class="org.yes.cart.promotion.impl.action.OrderGiftPromotionAction">
        <constructor-arg index="0" ref="priceService"/>
        <constructor-arg index="1" ref="shopService"/>
    </bean>

    <bean id="promoActionShippingDiscount" class="org.yes.cart.promotion.impl.action.ShippingDiscountPromotionAction"/>
    <bean id="promoActionShippingAmountOff" class="org.yes.cart.promotion.impl.action.ShippingAmountOffPromotionAction"/>

    <bean id="promoActionCustomerTag" class="org.yes.cart.promotion.impl.action.CustomerTagPromotionAction"/>

    <bean id="taxService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.TaxServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="taxDao"/>
            </bean>
        </property>
    </bean>

    <bean id="taxConfigService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.TaxConfigServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="taxConfigDao"/>
                <constructor-arg index="1" ref="taxService"/>
            </bean>
        </property>
    </bean>

    <bean id="mailService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.MailServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="mailDao"/>
            </bean>
        </property>
    </bean>



    <bean id="dataGroupService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.DataGroupServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="dataGroupDao"/>
            </bean>
        </property>
    </bean>

    <bean id="dataDescriptorService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.DataDescriptorServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="dataDescriptorDao"/>
            </bean>
        </property>
    </bean>

    <!-- ############################# ExtendedConversionService ################################# -->

    <bean id="extendedConversionService" class="org.yes.cart.utils.impl.ExtendedConversionService"/>

    <!-- ########################################### Mail ######################################## -->

    <bean id="mailTemplateResourcesProviderShopContent"
          class="org.yes.cart.service.mail.impl.MailTemplateResourcesProviderShopContentImpl">
        <constructor-arg index="0" ref="contentService"/>
        <constructor-arg index="1" ref="systemService"/>
        <constructor-arg index="2" ref="imageService"/>
    </bean>

    <bean id="mailTemplateResourcesProviderTheme"
          class="org.yes.cart.service.mail.impl.MailTemplateResourcesProviderThemeImpl"/>

    <bean id="mailTemplateResourcesProvider"
          class="org.yes.cart.service.mail.impl.MailTemplateResourcesProviderFactoryImpl">
        <constructor-arg index="0">
            <list>
                <!--
                    Order here is important as factory will take the first provider that is able to
                    provide non-empty value
                -->
                <ref bean="mailTemplateResourcesProviderShopContent"/>
                <ref bean="mailTemplateResourcesProviderTheme"/>
            </list>
        </constructor-arg>
    </bean>

    <bean id="mailComposer" class="org.yes.cart.service.mail.impl.MailComposerImpl">
        <constructor-arg index="0" ref="mailTemplateResourcesProvider"/>
    </bean>

    <!-- ############################# Shopping Cart Commands and Events ######################### -->


    <bean id="shoppingCartCommandFactory" class="org.yes.cart.shoppingcart.impl.ShoppingCartCommandFactoryImpl"/>

    <bean id="amountCalculationStrategy"
          class="org.yes.cart.shoppingcart.impl.DefaultAmountCalculationStrategy">  <!-- CPOINT cart calculation algorithm -->
        <constructor-arg index="0" ref="taxProvider"/>
        <constructor-arg index="1" ref="deliveryCostCalculationStrategy"/>
        <constructor-arg index="2" ref="promotionContextFactory"/>
        <constructor-arg index="3" ref="customerService"/>
    </bean>

    <bean id="deliveryCostCalculationStrategy"  class="org.yes.cart.shoppingcart.impl.DefaultDeliveryCostCalculationStrategy"> <!-- CPOINT delivery calculation strategy -->
        <constructor-arg index="0" ref="carrierSlaService"/>
    </bean>

    <bean id="taxProvider" class="org.yes.cart.shoppingcart.impl.TaxProviderImpl">
        <constructor-arg index="0" ref="taxService"/>
        <constructor-arg index="1" ref="taxConfigService"/>
    </bean>

    <bean id="orderNumberGenerator" class="org.yes.cart.service.order.impl.DefaultOrderNumberGeneratorImpl">
        <constructor-arg index="0" ref="customerOrderDao"/>
    </bean>

    <bean id="orderAddressFormatter" class="org.yes.cart.service.order.impl.DefaultOrderAddressFormatterImpl">
        <constructor-arg index="0" value="{{addrline1}} {{addrline2}} {{postcode}} {{city}} {{countrycode}} {{statecode}}, {{firstname}} {{middlename}} {{lastname}}, {{phone1}} {{mobile1}} {{email1}}"/>
    </bean>

    <bean id="customerNameFormatter" class="org.yes.cart.service.customer.impl.DefaultCustomerNameFormatterImpl">
        <constructor-arg index="0" value="{{firstname}} {{middlename}} {{lastname}}"/>
    </bean>

    <bean id="orderAssembler" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.service.order.impl.OrderAssemblerImpl">
                <constructor-arg index="0" ref="orderNumberGenerator"/>
                <constructor-arg index="1" ref="genericDao"/>
                <constructor-arg index="2" ref="customerService"/>
                <constructor-arg index="3" ref="shopService"/>
                <constructor-arg index="4" ref="productSkuService"/>
                <constructor-arg index="5" ref="orderAddressFormatter"/>
                <constructor-arg index="6" ref="promotionCouponService"/>
                <constructor-arg index="7" ref="addressService"/>
            </bean>
        </property>
    </bean>



    <bean id="deliveryAssembler" class="org.yes.cart.service.order.impl.DeliveryAssemblerImpl">
        <constructor-arg index="0" ref="warehouseService"/>
        <constructor-arg index="1" ref="skuWarehouseService"/>        
        <constructor-arg index="2" ref="carrierSlaService"/>
        <constructor-arg index="3" ref="productService"/>
    </bean>


    <!-- ################################## service locator ################################# -->

    <bean id="springInstantiationService" class="org.yes.cart.service.locator.impl.SpringInstantiationStrategyImpl"/>
    <bean id="webInstantiationService" class="org.yes.cart.service.locator.impl.WebServiceInstantiationStrategyImpl"/>
    <bean id="jnpInstantiationService" class="org.yes.cart.service.locator.impl.JnpInstantiationStrategyImpl"/>

    <bean id="serviceLocator" class="org.yes.cart.service.locator.impl.ServiceLocatorImpl">
        <constructor-arg index="0">
            <map>
                <entry key="http" value-ref="webInstantiationService"/>
                <entry key="https" value-ref="webInstantiationService"/>
                <entry key="jnp" value-ref="jnpInstantiationService"/>
                <entry>
                    <key><null/></key>
                    <ref bean="springInstantiationService"/>
                </entry>
            </map>
        </constructor-arg>

    </bean>

    <!-- ############################################ misc ####################################### -->

    <bean id="themeService" class="org.yes.cart.service.theme.impl.ThemeServiceImpl">
        <constructor-arg index="0" ref="shopService"/>
    </bean>

    <bean id="pluralFormService" class="org.yes.cart.service.misc.impl.PluralFormServiceImpl"/>

    <bean id="passPhraseGenerator" class="org.yes.cart.service.domain.impl.PassPhraseGeneratorImpl">
        <constructor-arg index="0" value="8"/>
    </bean>

    <bean id="passwordHashHelper" class="org.yes.cart.service.domain.impl.MD5HashHelperImpl"/>

    <bean id="languageService" class="org.yes.cart.service.misc.impl.LanguageServiceImpl">
        <constructor-arg index="0">
            <map>
                <entry key="en" value="Eng"/>
                <entry key="ru" value="&#x0420;&#x0443;&#x0441;"/>
                <entry key="uk" value="&#x0423;&#x043A;&#x0440;"/>
            </map>
        </constructor-arg>
        <constructor-arg index="1">
            <map>
                <entry key="DEFAULT">
                    <list>
                        <!-- by convention the 0th element is the default language -->
                        <value>en</value>
                        <value>ru</value>
                        <value>uk</value>
                    </list>
                </entry>
                <entry key="SHOP10">
                    <list>
                        <!-- by convention the 0th element is the default language -->
                        <value>en</value>
                        <value>ru</value>
                        <value>uk</value>
                    </list>
                </entry>
            </map>
        </constructor-arg>
        <constructor-arg index="2" ref="shopService"/>
    </bean>

    <!-- ########################################## WS support ########################## -->

    <bean id="wsAbstractFactoryClientFactory" class="org.yes.cart.web.service.ws.client.impl.WsAbstractFactoryClientFactoryImpl"/>

</beans>